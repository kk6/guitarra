# Guitarra - 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Guitarra（ギターラ）

### 1.2 プロジェクトの目的
ギター練習のためのコマンドラインツールを提供し、音楽理論に基づいた練習環境を構築する。

### 1.3 対象ユーザー
- ギター初心者から上級者まで
- 音楽理論を学習したいギタリスト
- コードプログレッションを練習したいミュージシャン
- コマンドラインツールを好む開発者

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 12バー・ブルース進行生成機能
- **機能ID**: F001
- **機能名**: 12バー・ブルース進行生成
- **説明**: 指定されたキーで12バー・ブルース進行を生成する
- **入力**:
  - ルート音（必須）：A, B, C, D, E, F, G（シャープ・フラット対応）
  - 進行タイプ（オプション）：メジャー（デフォルト）、マイナー
  - 度数表示（オプション）：ローマ数字による度数表示
- **出力**:
  - 12バーのコード進行表
  - 度数表示（オプション指定時）
- **例**:
  ```
  12 Bar Blues in A major (I-IV-V):

  |    A |    A |    A |    A |
  |    D |    D |    A |    A |
  |    E |    D |    A |    A |
  ```

#### 2.1.2 音名変換機能
- **機能ID**: F002
- **機能名**: 音名変換
- **説明**: フラット記号をシャープ記号に統一して処理する
- **入力**: フラット記号を含む音名（Bb, Db, Eb, Gb, Ab）
- **出力**: シャープ記号による音名（A#, C#, D#, F#, G#）

#### 2.1.3 コード進行フォーマット機能
- **機能ID**: F003
- **機能名**: コード進行フォーマット
- **説明**: 生成されたコード進行を見やすい表形式で表示する
- **入力**: コード進行配列
- **出力**: 4小節ずつ区切られた表形式の文字列

#### 2.1.4 ギター指板スケール表示機能
- **機能ID**: F004
- **機能名**: ギター指板スケール表示
- **説明**: 指定されたスケールをギターの指板図として表示する
- **入力**:
  - ルート音（必須）：A, B, C, D, E, F, G（シャープ・フラット対応）
  - スケール名（必須）：メジャー、マイナー、ペンタトニック等
  - 開始フレット（オプション）：デフォルト 0
  - 終了フレット（オプション）：デフォルト 12
  - 表示形式（オプション）：音名表示 or 度数表示（デフォルト：音名）
- **出力**:
  - ASCII文字による指板図
  - 各弦とフレットの交点にスケール音を表示
  - 弦名とフレット番号を含む
- **例**:
  ```
  C Major Scale (Frets 0-12):
  
  E|--F----G-A----B-C----D-E----F----G-A----B-C
  B|--C----D-E----F-G----A-B----C----D-E----F-G
  G|--A----B-C----D-E----F-G----A----B-C----D-E
  D|--E----F-G----A-B----C-D----E----F-G----A-B
  A|--B----C-D----E-F----G-A----B----C-D----E-F
  E|--F----G-A----B-C----D-E----F----G-A----B-C
     0 1 2 3 4 5 6 7 8 9 10 11 12
  ```

### 2.2 CLI機能

#### 2.2.1 コマンドライン解析機能
- **機能ID**: F005
- **機能名**: コマンドライン解析（ブルース進行）
- **説明**: ブルース進行生成のためのユーザー入力を解析し、適切な処理を実行する
- **コマンド構文**: `guitar blues <root> [--minor] [--degrees]`
- **オプション**:
  - `--minor, -m`: マイナー・ブルース進行を生成
  - `--degrees, -d`: ローマ数字による度数表示を有効化

#### 2.2.2 コマンドライン解析機能（スケール表示）
- **機能ID**: F006
- **機能名**: コマンドライン解析（スケール表示）
- **説明**: スケール表示機能のためのユーザー入力を解析し、適切な処理を実行する
- **コマンド構文**: `guitar scale <root> <scale_name> [--start=0] [--end=12] [--degrees]`
- **オプション**:
  - `--start, -s`: 開始フレット位置（デフォルト：0）
  - `--end, -e`: 終了フレット位置（デフォルト：12）
  - `--degrees, -d`: 度数表示を有効化（デフォルト：音名表示）
- **例**:
  - `guitar scale C major`: CメジャースケールをOpen〜12フレットで表示
  - `guitar scale A minor --start=5 --end=17`: AマイナースケールをV〜XVIIフレットで表示
  - `guitar scale E major --degrees`: EメジャースケールをOpen〜12フレットで度数表示

#### 2.2.3 タブ補完機能
- **機能ID**: F007
- **機能名**: コマンドライン タブ補完
- **説明**: コマンド、サブコマンド、オプション、引数の入力時にタブキーによる補完機能を提供する
- **対応シェル**: zsh, bash, fish, PowerShell
- **補完対象**:
  - メインコマンド: `guitar <TAB>` → `blues`, `scale`
  - スケール名: `guitar scale C <TAB>` → 利用可能な全スケール名を表示
  - オプション: `guitar blues A --<TAB>` → `--minor`, `--degrees`
  - 基本スケール: major, minor, pentatonic_major, pentatonic_minor
  - モード系: dorian, phrygian, lydian, mixolydian, aeolian, locrian
  - その他: blues, harmonic_minor, melodic_minor
- **技術仕様**:
  - Typer 0.12.0の標準補完システムを使用（内部でClickを使用）
  - パッケージインストール時に自動的に有効化
  - 説明付き補完候補の表示に対応
- **有効化方法**: `pip install -e .` または `uv pip install -e .`でパッケージをインストール

#### 2.2.4 エラーハンドリング機能
- **機能ID**: F008
- **機能名**: エラーハンドリング
- **説明**: 無効な入力に対して適切なエラーメッセージを表示する
- **エラー種別**:
  - 無効な音名入力
  - 無効なスケール名入力
  - 無効なフレット範囲指定
  - 不正なコマンド引数
- **出力**: エラーメッセージと有効な入力例

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **応答時間**: コマンド実行から結果表示まで1秒以内
- **メモリ使用量**: 実行時メモリ使用量は50MB以下

### 3.2 互換性要件
- **Python バージョン**: Python 3.12以上
- **OS**: macOS, Linux, Windows（クロスプラットフォーム対応）

### 3.3 保守性要件
- **コードカバレッジ**: テストカバレッジ90%以上
- **文書化**: 全ての公開APIにdocstringを記載
- **コードスタイル**: PEP 8準拠、Ruff によるフォーマット

### 3.4 拡張性要件
- **モジュール設計**: 新しい音楽理論機能を追加可能な設計
- **プラグイン対応**: 将来的にプラグインシステムの追加が可能

## 4. 技術要件

### 4.1 開発環境
- **言語**: Python 3.12+
- **パッケージマネージャー**: uv
- **テストフレームワーク**: pytest
- **リンター**: Ruff
- **タイプチェッカー**: mypy（将来的に対応予定）

### 4.2 依存関係
- **必須依存関係**:
  - typer >= 0.12.0（CLI フレームワーク、タブ補完機能を含む）
- **開発依存関係**:
  - pytest >= 8.3.5（テストフレームワーク）
  - pytest-cov >= 6.2.1（テストカバレッジ）

### 4.3 配布方法
- **パッケージ形式**: Python wheel
- **配布チャネル**: PyPI（将来的に対応予定）
- **インストール方法**: pip install または uv による開発環境セットアップ

## 5. 制約事項

### 5.1 技術的制約
- コマンドラインインターフェースのみ（GUI非対応）
- 音声出力機能なし
- MIDIファイル出力機能なし

### 5.2 仕様制約
- 12バー・ブルース進行のみ対応（他の進行パターンは将来実装予定）
- 基本的なメジャー・マイナー進行のみ対応
- 複雑な音楽理論（テンション、代理コード等）は対応外

## 6. 品質要件

### 6.1 テスト要件
- **単体テスト**: 全ての公開メソッドに対してテストを実装
- **テストパターン**: AAA（Arrange-Act-Assert）パターンを採用
- **テストケース**:
  - 正常系テスト
  - 異常系テスト（無効入力）
  - 境界値テスト

### 6.2 コード品質
- **コーディング規約**: PEP 8準拠
- **型ヒント**: 全ての関数・メソッドに型ヒントを記載
- **ドキュメント**: Google style docstringを採用

## 7. 将来的な拡張計画

### 7.1 短期計画（v0.2.0）
- ギター指板スケール表示機能の実装
- より多くの音楽スケール対応（ドリアン、フリジアン、リディアンなど）
- コード進行のバリエーション追加
- JSON/YAML形式での出力機能

### 7.2 中期計画（v0.3.0）
- 他の音楽ジャンルのコード進行対応
- 練習用メトロノーム機能
- 設定ファイルによるカスタマイズ機能

### 7.3 長期計画（v1.0.0）
- MIDI出力機能
- 音楽理論レッスン機能
- プラグインシステム

## 8. 用語集

| 用語 | 説明 |
|------|------|
| 12バー・ブルース | 12小節で構成されるブルース音楽の基本的なコード進行パターン |
| I-IV-V進行 | メジャースケールの1度、4度、5度のコードを使用した進行 |
| i-iv-V進行 | マイナースケールの1度、4度のマイナーコードと5度のメジャーコードを使用した進行 |
| ローマ数字記譜法 | 音楽理論で度数を表記するための記号体系 |
| ルート音 | コードやスケールの基となる音 |
| 度数 | スケール上の音程関係を数字で表したもの |
| スケール | 音楽で使用される音の集合を音の高さ順に配列したもの |
| 指板図 | ギターの指板を図で表現したもの、フレットと弦の交点を視覚的に表示 |
| フレット | ギターの指板に設置された金属の棒、音の高さを決定する |
| 音名表示 | 音を文字（A、B、C、D、E、F、G）で表示する方法 |
| 度数表示 | スケール内の音をルート音を基準とした数字で表示する方法 |
| オープン弦 | 何も押さえていない弦の音、0フレットの音 |
| タブ補完 | TABキーを押すことでコマンドの引数候補を表示・選択できる機能 |

---

**文書バージョン**: 1.4
**作成日**: 2025-07-05
**最終更新日**: 2025-07-05
**作成者**: Claude Code
**承認者**: -

## 更新履歴

| バージョン | 日付 | 更新内容 |
|-----------|------|----------|
| 1.0 | 2025-07-05 | 初版作成 |
| 1.1 | 2025-07-05 | スケール表示機能の追加 |
| 1.2 | 2025-07-05 | タブ補完機能の実装詳細更新、click-completion依存関係の削除 |
| 1.3 | 2025-07-05 | Typer依存関係への更新、Python 3.12要件への変更 |
| 1.4 | 2025-07-05 | タブ補完機能の実装方法を更新、install-completionコマンドが不要であることを明記 |
